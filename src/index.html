<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />

    <style>
      body { font-family: Tahoma, Geneva, sans-serif }
    </style>

    <!-- colyseus.js client -->
    <script type="text/javascript" src="https://unpkg.com/colyseus.js@^0.14.0/dist/colyseus.js"></script>

  </head>
  <body>
    <div id="status"></div>
    <ul id="opponents"></ul>

    <script>
      //var host = window.document.location.host.replace(/:.*/, '')

      const client = new Colyseus.Client('ws://spotit-backend.test:2567')
      client.joinOrCreate('spotit').then(room => {
        console.log('joined')
        room.onStateChange.once = state => {
            console.log('initial room state:', state)
        }

        room.state.players.onAdd = (player, sessionID) => {
          if (room.sessionId !== sessionID) {
            let li = document.createElement('li')
            li.innerText = player.playerName + ': ' + player.playerScore
            li.setAttribute('id', sessionID)
            document.querySelector("#opponents").appendChild(li)
          }
        }

        room.state.players.onRemove = (player, sessionID) => {
          document.getElementById(sessionID).remove()
        }

        // listen for status changes of player
        room.onMessage('status', function(status) {
            let div = document.createElement('div')
            div.innerHTML = status.playerName + '<br>'
            div.innerHTML += 'Your Score: ' + status.playerScore + '<br>'

            document.querySelector("#status").appendChild(div)
        })
      })

    </script>
  </body>
</html>
