<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />

    <style>
      body { font-family: Tahoma, Geneva, sans-serif }
    </style>

    <!-- colyseus.js client -->
    <script type="text/javascript" src="https://unpkg.com/colyseus.js@^0.14.0/dist/colyseus.js"></script>
  </head>
  <body>
    <div id="status"></div>
    <ul id="opponents">
      <h3>Opponents:</h3>
    </ul>
    <div id="tablearea">
      <div id="main_card"></div>
      <div id="player_card"></div>
      <div id="opponent_card"></div>
    </div>

    <script>
      //var host = window.document.location.host.replace(/:.*/, '')

      const client = new Colyseus.Client('ws://spotit-backend.test:2567')
      client.joinOrCreate('spotit').then(room => {
        console.log('joined')
        room.onStateChange.once = state => {
            console.log('initial room state:', state)
        }

        room.state.players.onAdd = (player, sessionID) => {
          if (room.sessionId !== sessionID) {
            let li = document.createElement('li')
            li.innerText = player.playerName + ': ' + player.playerScore
            li.setAttribute('id', sessionID)
            document.querySelector("#opponents").appendChild(li)
          }
        }

        room.state.drawnCard.onChange = (card, key) => {
          console.log(card, 'have changes at', key)
        }

        room.state.players.onRemove = (player, sessionID) => {
          document.getElementById(sessionID).remove()
        }

        // listen for status changes of player
        room.onMessage('status', function(status) {
            let div = document.createElement('div')
            div.innerHTML = '<h1>' + status.playerName + '</h1><br>'
            div.innerHTML += '<h3>Your Score: ' + status.playerScore + '</h3><br>'

            document.querySelector("#status").appendChild(div)
        })
        console.log(room.state)
      })

    </script>
  </body>
</html>
